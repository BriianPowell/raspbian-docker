version: '3.3'
services:
  home-assistant:
    image: homeassistant/home-assistant
    network_mode: host
    restart: on-failure
    extra_hosts:
      - 'host.docker.internal:10.0.0.15'
      - 'hass-db:10.0.0.15'
    ports:
      - '56700:56700'
      - '8123:8123'
    volumes: 
      - ~/GitHub/hass-config:/config
      - /etc/localtime:/etc/localtime:ro
    depends_on:
      - hass-db
      - host-hostnames
      - mqtt-broker
  hass-db:
    image: postgres:13
    extra_hosts:
    - 'host.docker.internal:10.0.0.15'
    ports:
      - '5432:5432'
    volumes:
      - /usr/local/lib/hass-postgres-data:/var/lib/postgresql/data
    environment:
      POSTGRES_DB: hass
    env_file: 'hass-postgres.env'
  mqtt-broker:
    image: eclipse-mosquitto
    ports:
      - '1883:1883'
      - '9001:9001'
    volumes:
      - /usr/local/etc/docker-mosquitto:/mosquitto/config
      - /usr/local/lib/docker-mosquitto:/mosquitto/data
  host-hostnames:
    image: dvdarias/docker-hoster
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock
      - /etc/hosts:/tmp/hosts
